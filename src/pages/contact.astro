---
import '../styles/global.css';
import Footer from '../components/Footer.astro';
---

<!doctype html>
<html lang="ja" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>お問い合わせ | PODDOCK</title>
  </head>
  <body class="min-h-screen bg-base-100">
    <!-- Header -->
    <header class="navbar bg-base-100 border-b border-base-200 px-4 sm:px-6 lg:px-12">
      <div class="flex-1">
        <a href="/" class="flex items-center gap-2 text-xl sm:text-2xl font-bold">
          <img src="/logo.png" alt="PODDOCK" class="w-8 h-8 sm:w-10 sm:h-10" />
          PODDOCK
        </a>
      </div>
      <div class="flex-none gap-2">
        <a href="/login" class="btn btn-ghost btn-sm sm:btn-md">ログイン</a>
      </div>
    </header>

    <!-- Content -->
    <main class="max-w-xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
      <h1 class="text-2xl sm:text-3xl font-bold mb-2">お問い合わせ</h1>
      <p class="text-base-content/70 mb-8">ご質問・ご要望などお気軽にお問い合わせください。</p>

      <div id="form-container">
        <form id="contact-form" class="space-y-6">
          <div class="form-control">
            <label class="label" for="name">
              <span class="label-text">お名前 <span class="text-error">*</span></span>
            </label>
            <input
              type="text"
              id="name"
              name="name"
              class="input input-bordered w-full"
              required
            />
          </div>

          <div class="form-control">
            <label class="label" for="email">
              <span class="label-text">メールアドレス <span class="text-error">*</span></span>
            </label>
            <input
              type="email"
              id="email"
              name="email"
              class="input input-bordered w-full"
              required
            />
          </div>

          <div class="form-control">
            <label class="label" for="subject">
              <span class="label-text">件名 <span class="text-error">*</span></span>
            </label>
            <select id="subject" name="subject" class="select select-bordered w-full" required>
              <option value="" disabled selected>選択してください</option>
              <option value="general">一般的なお問い合わせ</option>
              <option value="bug">不具合の報告</option>
              <option value="feature">機能のリクエスト</option>
              <option value="billing">お支払いについて</option>
              <option value="other">その他</option>
            </select>
          </div>

          <div class="form-control">
            <label class="label" for="message">
              <span class="label-text">メッセージ <span class="text-error">*</span></span>
            </label>
            <textarea
              id="message"
              name="message"
              class="textarea textarea-bordered w-full h-40"
              required
            ></textarea>
          </div>

          <div id="error-message" class="alert alert-error hidden">
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>送信に失敗しました。しばらく経ってから再度お試しください。</span>
          </div>

          <button type="submit" id="submit-btn" class="btn btn-primary w-full">
            送信する
          </button>
        </form>
      </div>

      <div id="success-message" class="hidden text-center py-12">
        <div class="flex justify-center mb-4">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-16 h-16 text-success">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
          </svg>
        </div>
        <h2 class="text-xl font-bold mb-2">送信完了</h2>
        <p class="text-base-content/70 mb-6">お問い合わせありがとうございます。<br />内容を確認の上、ご連絡いたします。</p>
        <a href="/" class="btn btn-ghost">トップに戻る</a>
      </div>
    </main>

    <Footer />

    <script>
      const form = document.getElementById('contact-form');
      const formContainer = document.getElementById('form-container');
      const successMessage = document.getElementById('success-message');
      const errorMessage = document.getElementById('error-message');
      const submitBtn = document.getElementById('submit-btn');

      form?.addEventListener('submit', async (e) => {
        e.preventDefault();

        errorMessage?.classList.add('hidden');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="loading loading-spinner loading-sm"></span>';

        const formData = new FormData(form);
        const data = {
          name: formData.get('name'),
          email: formData.get('email'),
          subject: formData.get('subject'),
          message: formData.get('message'),
        };

        try {
          const response = await fetch('/api/contact', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
          });

          if (response.ok) {
            formContainer?.classList.add('hidden');
            successMessage?.classList.remove('hidden');
          } else {
            throw new Error('Failed to send');
          }
        } catch {
          errorMessage?.classList.remove('hidden');
          submitBtn.disabled = false;
          submitBtn.textContent = '送信する';
        }
      });
    </script>
  </body>
</html>

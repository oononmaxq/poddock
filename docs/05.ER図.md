# ER図.md（poddock / MVP）

## 1. 論理ER図（Mermaid）

> 目的：MVP実装で迷わないための「関係・制約」を明確化する  
> ※ Mermaid対応のMarkdownビューアでレンダリング可能

```mermaid
erDiagram
  ADMIN_USER {
    string id PK
    string email UNIQUE
    string password_hash
    datetime created_at
  }

  PODCAST {
    string id PK
    string title
    string description
    string language
    string category
    string author_name NULL
    string contact_email NULL
    boolean explicit
    string visibility  "public|private"
    string cover_image_asset_id FK NULL
    string private_feed_token_id FK NULL
    datetime created_at
    datetime updated_at
  }

  EPISODE {
    string id PK
    string podcast_id FK
    string title
    string description NULL
    string status "draft|published"
    datetime published_at NULL
    string audio_asset_id FK NULL
    int duration_seconds NULL
    datetime created_at
    datetime updated_at
  }

  ASSET {
    string id PK
    string type "audio|image"
    string storage_provider
    string storage_bucket
    string storage_key
    string public_url
    string content_type
    long byte_size
    string checksum NULL
    datetime created_at
  }

  FEED_TOKEN {
    string id PK
    string podcast_id FK UNIQUE
    string token UNIQUE
    datetime revoked_at NULL
    datetime created_at
  }

  DISTRIBUTION_TARGET {
    string id PK "apple|spotify|amazon"
    string name
    string submit_url
    datetime created_at
  }

  DISTRIBUTION_STATUS {
    string id PK
    string podcast_id FK
    string target_id FK
    string status "not_submitted|submitted|live|needs_attention"
    string note NULL
    datetime last_checked_at NULL
    datetime created_at
    datetime updated_at
  }

  PODCAST ||--o{ EPISODE : "has"
  EPISODE o|--|| ASSET : "audio (1 episode = 0..1 asset)"
  PODCAST o|--|| ASSET : "cover image (0..1)"
  PODCAST o|--|| FEED_TOKEN : "private feed token (0..1)"
  PODCAST ||--o{ DISTRIBUTION_STATUS : "distribution statuses"
  DISTRIBUTION_TARGET ||--o{ DISTRIBUTION_STATUS : "status per target"
```

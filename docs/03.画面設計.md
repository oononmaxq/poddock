# 画面設計.md（poddock / MVP）

## 1. 目的

本ドキュメントは、poddock MVP の画面構成（UIツリー）と各画面の入出力（I/O）、主要操作、状態遷移を定義し、実装とQAの共通認識を作ることを目的とする。

---

## 2. 前提（MVP方針）

- poddock は「聴く場所」ではなく管理・配信のハブ（Headless）
- 再生プレイヤーは実装しない（必要なら管理画面内の簡易プレビューは将来検討）
- 単一管理者（シンプルなログイン）を前提
- 配信先連携は「半自動（ウィザード＋状態管理）」で実現
- 対応配信先：Apple Podcasts / Spotify / Amazon Music（Audible含む）
- 対応音声形式：MP3 / M4A / WAV

---

## 2.1 画面遷移とUI体験方針

poddock の管理画面では、操作体験向上のため
Astro の View Transitions / ClientRouter を利用し、
SPAライクな画面遷移を実現する。

### 基本方針

- ページ構成は MPA を維持する
- 画面遷移は ClientRouter によりクライアントルーティングとする
- ヘッダ・サイドバーなどの共通UIは同一レイアウトに配置し、遷移時も再描画しない（永続UI）

### 想定する効果

- 画面遷移時のちらつきを抑制
- フォーム中心の管理画面における操作レスポンス向上
- SPAのような操作感を、MPAの構造を保ったまま実現

### 実装上の注意

- 遷移後に初期化が必要なJavaScript処理は、ClientRouterの遷移完了後に再実行される前提で実装する
- 外部リンク（Apple/Spotify/Amazon提出ページなど）はClientRouterによる遷移対象外とする
- 音声ファイルのダウンロードやRSS取得など、データ取得系のリンクは通常遷移を優先する

---

## 3. 画面ツリー（Sitemap）

- `/login` ログイン
- `/` ダッシュボード（番組一覧）
- `/podcasts/new` 番組作成
- `/podcasts/:podcastId` 番組詳細（タブ）
  - `overview` 概要（RSS・公開設定・メタ情報）
  - `episodes` エピソード一覧
  - `distribution` 配信先（ウィザード・ステータス）
  - `settings` 詳細設定（MVP内で必要最小）
- `/podcasts/:podcastId/episodes/new` エピソード作成
- `/podcasts/:podcastId/episodes/:episodeId` エピソード編集
- `/podcasts/:podcastId/rss` RSS確認（読み取り専用ページ：RSS URL・プレビュー）
- `/help/distribution` 配信先提出ヘルプ（短い手順）

> 注：`/podcasts/:podcastId/rss.xml` などのRSS実体URLはAPI/配信エンドポイント側で提供（画面はURLを表示するだけ）

---

## 4. 画面仕様（Screen Specs）

### 4.1 ログイン（`/login`）

**目的**

- 管理者が管理画面にアクセスするための認証

**表示**

- メールアドレス
- パスワード
- ログインボタン
- エラーメッセージ領域

**操作**

- ログイン成功 → `/` へ遷移
- ログイン失敗 → エラー表示

**受け入れ条件**

- 未ログインでは管理画面系URLへアクセスできない（ログインへリダイレクト）

---

### 4.2 ダッシュボード（番組一覧）`/`

**目的**

- Podcast（番組）の一覧表示と主要操作の起点

**表示**

- 番組カード/行（最小）
  - カバーアート（サムネ）
  - タイトル
  - 公開状態（公開/非公開）
  - エピソード数
  - 配信先ステータス概要（例：Apple=公開中 / Spotify=未提出 など）
  - 更新日時
- 「番組作成」ボタン

**操作**

- 番組クリック → `/podcasts/:podcastId` へ遷移
- 「番組作成」 → `/podcasts/new` へ遷移

**受け入れ条件**

- 番組が0件でも空状態UIが表示される（作成導線あり）

---

### 4.3 番組作成（`/podcasts/new`）

**目的**

- 新規Podcastを作成する

**入力（必須/任意）**

- タイトル（必須）
- 説明（必須 or 推奨：要件に合わせる）
- 言語（必須：デフォルト `ja`）
- カテゴリ（必須 or 推奨）
- 著者名（任意）
- explicit（任意：デフォルト false）
- カバーアート（任意：後でも可）
- 公開設定（公開 / 非公開：デフォルト 非公開）

**操作**

- 「作成」→ 作成後 `/podcasts/:podcastId` へ遷移
- 「キャンセル」→ `/` へ戻る

**バリデーション**

- 必須未入力時は保存不可（エラーメッセージ）

---

### 4.4 番組詳細（`/podcasts/:podcastId`）

**目的**

- 番組の管理（RSS・公開設定・エピソード・配信先）を行う

**共通表示（ヘッダ）**

- カバーアート
- タイトル
- 公開状態（公開/非公開）
- RSS URL（公開/非公開）簡易表示 + Copyボタン
- タブ：Overview / Episodes / Distribution / Settings
- 「エピソード追加」ボタン（常設してもよい）

---

#### 4.4.1 Overview（`/podcasts/:podcastId?tab=overview`）

**目的**

- RSSと公開設定、番組メタ情報の中核を確認・編集

**表示**

- 公開RSS URL + Copy
- 非公開RSS URL（token付き）+ Copy（非公開の場合 or いつでも発行）
- RSS最終更新日時
- 番組メタ情報（タイトル/説明/言語/カテゴリ/著者/explicit）
- 公開設定トグル（公開/非公開）

**操作**

- メタ情報編集 → 保存
- 公開/非公開切替
- 「非公開RSSを再発行（token更新）」ボタン（MVPは任意。入れるなら“再発行＝旧token無効化”）

**受け入れ条件**

- 公開/非公開切替がRSS URL表示と実体の挙動に一致する
- 保存内容がRSSに反映される

---

#### 4.4.2 Episodes（`/podcasts/:podcastId?tab=episodes`）

**目的**

- エピソードの一覧管理

**表示**

- エピソード一覧（テーブル/カード）
  - タイトル
  - 状態（下書き/公開）
  - 公開日時
  - 音声形式（MP3/M4A/WAV）
  - ファイルサイズ
  - 更新日時
- フィルタ（任意：公開/下書き）
- 「エピソード作成」ボタン

**操作**

- 行クリック → `/podcasts/:podcastId/episodes/:episodeId`
- 「エピソード作成」→ `/podcasts/:podcastId/episodes/new`

**受け入れ条件**

- 下書きはRSSに出ない（一覧では見える）
- 公開状態変更が一覧に即反映

---

#### 4.4.3 Distribution（`/podcasts/:podcastId?tab=distribution`）

**目的**

- 配信先（Apple/Spotify/Amazon）への提出支援（半自動）と状態管理

**表示（配信先カード×3）**

- 配信先名（Apple / Spotify / Amazon Music）
- 現在ステータス：未提出 / 提出済 / 公開中 / 要対応
- 提出に使うRSS URL（Copyボタン）
- メモ（任意）
- 最終更新日（ステータス更新日）

**操作（共通）**

- ステータス更新（プルダウン）
- 「提出ウィザードを開く」
- 「RSS要件チェック」実行 → 結果表示（OK/NG + 修正ガイド）

**提出ウィザード（モーダル or サブページ）**

- Step 1：RSS URLコピー
- Step 2：公式提出ページへ移動（外部リンクボタン）
- Step 3：提出後、poddock側ステータスを「提出済」に更新
- Step 4：公開確認後「公開中」に更新

**受け入れ条件**

- RSS URLコピー導線が迷わない
- 3配信先で同一UXを保つ
- バリデーション結果が具体的（どの項目を直すか）

---

#### 4.4.4 Settings（`/podcasts/:podcastId?tab=settings`）

**目的**

- 番組の削除など、危険操作を分離

**表示**

- 番組削除（危険ボタン）
- 非公開RSS token 再発行（採用する場合はここに配置）
- 画像差し替え

**操作**

- 削除確認ダイアログ → 実行

**受け入れ条件**

- 削除は二段階確認
- 削除後はダッシュボードへ遷移

---

### 4.5 エピソード作成（`/podcasts/:podcastId/episodes/new`）

**目的**

- 新規エピソード作成と音声アップロード

**入力（必須/任意）**

- タイトル（必須）
- 説明（任意）
- 公開日時（任意：公開時に必須でも良い）
- 状態（下書き/公開：デフォルト 下書き）
- 音声ファイル（必須：公開するには必須）

**アップロードUI**

- ドラッグ＆ドロップ
- 進捗表示
- 形式チェック（MP3/M4A/WAV）
- サイズ表示

**操作**

- 「保存（下書き）」→ 下書き保存
- 「公開」→ 必須条件満たすなら公開
- 「キャンセル」→ Episodes一覧へ

**受け入れ条件**

- 非対応形式はアップロード不可（理由表示）
- 公開時、RSSに即反映

---

### 4.6 エピソード編集（`/podcasts/:podcastId/episodes/:episodeId`）

**目的**

- エピソードの編集・公開状態変更・ファイル差し替え

**表示**

- エピソード基本情報（タイトル/説明/公開日時/状態）
- 音声ファイル情報
  - 形式
  - サイズ
  - URL（表示のみ or Copy）
- 削除ボタン

**操作**

- 情報更新 → 保存
- 状態変更（下書き⇄公開）
- 音声差し替え（上書き or 新規アップロード）
- 削除（確認あり）

**受け入れ条件**

- 状態変更がRSSに反映
- 差し替え後、enclosureが更新される

---

### 4.7 RSS確認ページ（`/podcasts/:podcastId/rss`）

**目的**

- RSS URLを明示し、簡易プレビュー・検証導線を提供

**表示**

- 公開RSS URL（Copy）
- 非公開RSS URL（Copy）
- RSSのテキストプレビュー（任意：折りたたみ）
- 「RSS要件チェック」ボタン
- 「外部で開く」リンク

**受け入れ条件**

- URLが誤りなく提示される
- どのRSSがどの用途かが明確

---

## 5. 状態・遷移（State & Flows）

### 5.1 エピソード公開状態

- 下書き：RSSに含めない
- 公開：RSSに含める

**遷移**

- 下書き → 公開：公開日時と音声ファイルが揃っている場合に許可
- 公開 → 下書き：RSSから除外（再クロールまでタイムラグは許容）

---

### 5.2 番組公開状態

- 公開：公開RSS URLを提供
- 非公開：公開RSSは無効化（または404/403）、非公開RSSのみ有効

> MVPの推奨：公開RSSは番組が非公開の場合 404 or 403 で明確化

---

### 5.3 配信先ステータス（手動管理）

- 未提出 → 提出済 → 公開中
- 要対応：ユーザーが任意にセット（バリデーションNGや審査差し戻し等）

---

## 6. UI共通コンポーネント（推奨）

- Header：番組名 / RSS Copy / 公開状態
- CopyButton：コピー成功トースト
- StatusBadge：下書き/公開、配信先ステータス
- ValidationPanel：OK/NG一覧 + 修正ガイド
- DangerZone：削除など危険操作

---

## 7. MVPでやらないUI（明確化）

- 再生プレイヤー（フル機能）
- 詳細分析ダッシュボード
- 複数ユーザー/権限管理UI
- 収益化/課金UI

---
